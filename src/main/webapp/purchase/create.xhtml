<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:jsf="http://xmlns.jcp.org/jsf/passthrough"
                template="/WEB-INF/layout/template.xhtml">

<ui:define name="title">Home</ui:define>
    <f:metadata>
        <f:viewAction action="#{identity.isLoggedIn()}"/>
        <f:viewAction action="#{permissionBean.canAccess(101)}"/>
    </f:metadata>
    <ui:define name="body">

    <div class="row">
    <o:highlight/>

    <div class="col-lg-12">
    <h:form id="empForm" class="form-horizontal" role="form" prependId="false" enctype="multipart/form-data"
            acceptcharset="UTF-8">
    <script>
        $(document).ready(function() {
            if (document.referrer != "") {
                var referringURL = document.referrer;
                if(referringURL.indexOf("purchase/modal/CreateModalScopeSupply.jsf") != -1){
                    console.log("is create scope supply");
                    hasChanges = true;
                }else if(referringURL.indexOf("purchase/modal/CreateModalScopeSupplyEditing.jsf") != -1){
                    console.log("is create scope supply editing");
                    hasChanges = true;
                }else if(referringURL.indexOf("purchase/modal/EditModalScopeSupply.jsf") != -1){
                    console.log("is edit scope supply")
                    hasChanges = true;
                }else if(referringURL.indexOf("purchase/modal/EditModalScopeSupplyEditing.jsf") != -1){
                    console.log("is edit scope supply editing")
                    hasChanges = true;
                }else if(referringURL.indexOf("purchase/modal/EditModalSplitScopeSupply.jsf") != -1){
                    console.log("is edit split scope supply")
                    hasChanges = true;
                }
            }
        });
    </script>
    <!-- Form Name -->
    <h2 class="sub-header">#{msgs['po.new.title']}</h2>

    <div class="row">
        <div class="col-lg-6">
            <!-- Text input-->
            <div class="form-group">
                <p:outputLabel for="projectName" class="col-sm-4 control-label" value="#{msgs['po.lbl.project']}"/>

                <div class="col-sm-8">
                    <h:inputText id="projectName" type="text"
                                 required="true"
                                 maxlength="50"
                                 jsf:placeholder="#{msgs['po.ph.project']}"
                                 value="#{purchaseOrderCreate.newPurchaseOrder.project}"
                                 class="form-control"
                                 requiredMessage="#{msgs['po.lbl.project.required']}"/>
                    <p:message for="projectName" id="msgProject"/>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="form-group">
                <div class="col-sm-12">
                    <p:inputTextarea type="text" class="form-control" id="description"
                                     style="max-height:34px;"
                                     maxlength="998"
                                     value="#{purchaseOrderCreate.newPurchaseOrder.description}"
                                     jsf:placeholder="#{msgs['po.ph.description']}"/>
                    <p:message for="description" />
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <p:outputLabel for="po" class="col-sm-4 control-label" value="#{msgs['po.lbl.po']}"/>

                <div class="col-sm-8">
                    <h:inputText id="po" type="text" jsf:placeholder="#{msgs['po.ph.po']}"
                                 maxlength="50"
                                 required="true"
                                 value="#{purchaseOrderCreate.newPurchaseOrder.po}"
                                 class="form-control"
                                 requiredMessage="#{msgs['po.lbl.reference.required']}"/>
                    <p:message for="po" id="msgPO"/>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label" value="#{msgs['po.lbl.variation']}"/>

                <div class="col-sm-8">
                    <h:inputText id="variation" maxlength="50" type="text"
                                 value="#{purchaseOrderCreate.newPurchaseOrder.variation}"
                                 jsf:placeholder="#{msgs['po.ph.variation']}" class="form-control"/>
                    <p:message for="variation" />
                </div>
            </div>
        </div>
    </div>
    <!-- Text input-->
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label" value="#{msgs['po.lbl.location']}"/>

                <div class="col-sm-8">
                    <h:inputText id="supplier" type="text" maxlength="50"
                                 value="#{purchaseOrderCreate.newSupplier.supplier}"
                                 jsf:placeholder="#{msgs['po.ph.location']}" class="form-control"/>
                    <p:message for="supplier" />
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label" value="#{msgs['po.lbl.address']}"/>

                <div class="col-sm-8">
                    <p:inputTextarea id="address" maxlength="499" type="text"
                                     style="max-height: 60px;"
                                     value="#{purchaseOrderCreate.newSupplier.address}"
                                     jsf:placeholder="#{msgs['po.ph.address']}" class="form-control"/>
                    <p:message for="address" id="msgAddress"/>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <p:inputTextarea id ="addressDescription" maxlength="998" value="#{purchaseOrderCreate.newSupplier.addresDescription}"
                             style="max-height: 60px;" class="form-control"
                             jsf:placeholder="#{msgs['po.ph.address.description']}"/>
            <p:message for="addressDescription"/>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label"
                               value="#{msgs['po.lbl.contact.name']}"/>

                <div class="col-sm-8">
                    <h:inputText id="contactName" maxlength="100" type="text"
                                 value="#{purchaseOrderCreate.newSupplier.contactName}"
                                 jsf:placeholder="#{msgs['po.ph.contact.name']}"
                                 class="form-control"/>
                    <p:message for="contactName"/>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <p:inputTextarea maxlength="998" type="text" id="cnDescription"
                             style="max-height: 34px;"
                             value="#{purchaseOrderCreate.newSupplier.contactNameDescription}"
                             jsf:placeholder="#{msgs['po.ph.contact.name.description']}"
                             class="form-control"/>
            <p:message for="cnDescription"/>
        </div>
    </div>
    <div class="row">
        <!-- Text input-->
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label" value="#{msgs['po.lbl.po.title']}"/>

                <div class="col-sm-8">
                    <h:inputText id="poTitle" maxlength="50" type="text"
                                 value="#{purchaseOrderCreate.newPurchaseOrder.poTitle}"
                                 jsf:placeholder="#{msgs['po.ph.po.title']}" class="form-control"/>
                    <p:message for="poTitle"/>
                </div>
            </div>
        </div>
    </div>
    <!-- Text input-->
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label"
                               value="#{msgs['po.lbl.po.inco.term']}"/>

                <div class="col-sm-4">
                    <p:selectOneMenu id="incoTermSelectOne" value="#{purchaseOrderCreate.newPurchaseOrder.poIncoTerm}"
                                     effect="fold" editable="true"
                                     maxlength="50"  style="width: 100%">
                        <f:selectItems value="#{incoTerms}"/>
                    </p:selectOneMenu>
                    <p:message for="incoTermSelectOne"/>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <p:inputTextarea style="max-height: 34px;" id="incoTermDescription"
                             maxlength="998" type="text"
                             value="#{purchaseOrderCreate.newPurchaseOrder.poIncoTermDescription}"
                             jsf:placeholder="#{msgs['po.ph.inco.term.description']}" class="form-control"/>
            <p:message for="incoTermDescription"/>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label"
                               value="#{msgs['po.lbl.po.delivery.date']}"/>

                <div class="col-sm-4 col-xs-6">
                    <p:calendar id="deliveryDate" type="text" styleClass="calendar"
                                navigator="true" mask="#{configuration.mask}"
                                pattern="#{configuration.formatDate}"
                                jsf:placeholder="#{configuration.formatDate}"
                                converterMessage="#{msgs['validator.date.invalid']}"
                                value="#{purchaseOrderCreate.newPurchaseOrder.poDeliveryDate}"
                                onselect="calendarChanges();" onchange="calendarChanges();" >
                        <p:ajax process="@this" event="dateSelect" />
                    </p:calendar>
                    <h:message for="deliveryDate" id="msgDeliveryDate"/>
                </div>
            </div>
        </div>
        <div class="col-lg-6">

            <p:inputTextarea style="max-height: 34px;" id="poDeliveryDateDescription"
                             maxlength="998" type="text"
                             value="#{purchaseOrderCreate.newPurchaseOrder.poDeliveryDateDescription}"
                             jsf:placeholder="#{msgs['po.ph.delivery.date']}" class="form-control"/>
            <p:message for="poDeliveryDateDescription"/>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <h:outputLabel class="col-sm-4 control-label"
                               value="#{msgs['po.lbl.responsible']}"/>

                <div class="col-sm-8">
                    <h:inputText id="responsible" type="text" maxlength="100"
                                 value="#{purchaseOrderCreate.newPurchaseOrder.responsibleExpediting}"
                                 jsf:placeholder="#{msgs['po.ph.responsible']}"
                                 class="form-control"/>
                    <p:message for="responsible"/>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <ui:include src="components/CreateScopeSupply.xhtml"/>
    </div>
    <br/>

    <div class="row">
        <ui:include src="components/CreateAdditionalData.xhtml"/>
    </div>
    <br/>

    <div class="row">
        <ui:include src="components/CreateAttachments.xhtml"/>
    </div>
    <br/>
    <br/>

    <div class="row">
        <div class="col-lg-12">
            <div class="form-group">
                <div class="pull-right">
                    <h:commandButton id="save" value="#{msgs['lbl.save']}" class='btn btn-primary'
                                     action="#{purchaseOrderCreate.doSave}"/>
                    &#160;
                    <h:commandButton id="add" value="#{msgs['lbl.save.add']}" class='btn btn-primary'
                                     action="#{purchaseOrderCreate.doSaveAndAdd()}"/>
                    &#160;
                    <h:commandButton id="cancelCreateBtn"
                                     value="#{msgs['lbl.cancel']}"
                                     class='btn btn-primary'>
                        <p:ajax process="@this"
                                oncomplete="if(hasChanges)PF('confCancelDlg').show();else window.location='../purchase/list.jsf?faces-redirect=true'"/>
                    </h:commandButton>
                </div>
            </div>
        </div>
    </div>
    <p:confirmDialog widgetVar="confCancelDlg" id="cconfirmDialogId" header="Cancel">
        <f:facet name="message">
            <div>
                <div class="col-md-1">
                    <h:graphicImage name="img/icon-alert.jpg"/>
                </div>
                <div class="col-md-11">
                    Do you wish to leave this page and lose your unsaved data?
                    <br/>(including changes to Scopes of Supply).
                </div>
            </div>
        </f:facet>


        <div class="pull-right">
            <h:commandButton value="#{msgs['lbl.yes']}"
                             class='btn btn-primary'
                             immediate="true"
                             action="#{purchaseOrderCreate.cancelCreatePurchaseOrder}">
            </h:commandButton>
            &#160;
            <button class="btn btn-primary" type="button"
                    onclick="PF('confCancelDlg').hide();">
                #{msgs['lbl.no']}
            </button>
        </div>
    </p:confirmDialog>
    </h:form>
    </div>
    <!-- /.col-lg-12 -->
    </div>

    <p:dialog id="commentModalId" header="#{msgs['modal.comment.title']}" widgetVar="commentModal" resizable="false"
              height="300" width="700">
        <ui:include src="modal/CreateModalComment.xhtml"/>
    </p:dialog>
    <p:dialog id="commentModalEditId" header="#{msgs['modal.comment.edit.title']}" widgetVar="commentEditModal"
              resizable="false" height="300" width="700">
        <ui:include src="modal/CreateCommentModalEdit.xhtml"/>
    </p:dialog>
    </ui:define>
</ui:composition>
