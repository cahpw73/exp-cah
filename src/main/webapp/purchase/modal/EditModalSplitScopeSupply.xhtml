<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf/passthrough"
                template="/WEB-INF/layout/template.xhtml">
<f:metadata>
    <f:viewAction action="#{identity.isLoggedIn()}"/>
</f:metadata>
<ui:define name="body">
    <h:form id="scopeSupplySplitFormId" role="form" prependId="false" enctype="multipart/form-data"
            acceptcharset="UTF-8">
        <div class="col-md-3">
            <div class="form-group">
                <p:outputLabel for="arrivedQuantity"
                               value="#{msgs['supply.scope.split.lbl.initial.quantity']}"/>
                <h:inputText id="arrivedQuantity" type="text"
                             jsf:placeholder="#{msgs['po.supply.scope.column.quantity']}"
                             value="#{purchaseOrderEdit.selectedScopeSupply.quantity}"
                             class="form-control"
                             requiredMessage="#{msgs['po.supply.scope.lbl.quantity.initial.msg.error']}"
                             validatorMessage="#{msgs['po.supply.scope.lbl.quantity.initial.msg.error']}"
                             converterMessage="#{msgs['po.supply.scope.lbl.quantity.initial.msg.error']}"
                             onkeyup="calculateNewScopeSupplyQuantity();"
                             onblur="verifyArrivedQuantity();">
                </h:inputText>
                <p:message for="arrivedQuantity"/>
            </div>
            <div class="form-group">
                <h:outputLabel for="arrivedActualSiteDate" value="#{msgs['supply.scope.lbl.actual.site.date']}"/>
                <p:calendar id="arrivedActualSiteDate" mask="#{configuration.mask}"
                            navigator="true"
                            pattern="#{configuration.formatDate}"
                            converterMessage="#{msgs['validator.date.invalid']}"
                            jsf:placeholder="#{configuration.formatDate}"
                            value="#{purchaseOrderEdit.selectedScopeSupply.actualSiteDate}"
                            onselect="calendarChanges();" onchange="calendarChanges();">
                </p:calendar>
            </div>
        </div>
        <div class="col-md-9">
            <div class="col-md-12">
                <div class="col-md-4">
                    <div class="form-group">
                        <p:outputLabel for="newQuantitySupplySplit" value="#{msgs['po.supply.scope.column.quantity']}"/>
                        <h:inputText id="newQuantitySupplySplit"
                                     jsf:placeholder="#{msgs['po.supply.scope.column.quantity']}"
                                     value="#{purchaseOrderEdit.scopeSupplySplit.quantity}"
                                     class="form-control"
                                     requiredMessage="#{msgs['po.supply.scope.lbl.quantity.msg.error']}"
                                     validatorMessage="#{msgs['po.supply.scope.lbl.quantity.msg.error']}"
                                     converterMessage="#{msgs['po.supply.scope.lbl.quantity.msg.error']}"
                                     onkeyup="calculateOldScopeSupplyQuantity();"
                                     onblur="verifyNewQuantity();">
                        </h:inputText>
                        <p:message for="newQuantitySupplySplit" id="msgScopeSupplySplitQuantity"/>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <p:outputLabel for="unitId" value="#{msgs['po.supply.scope.column.unit']}"/>
                        <h:outputText id="unitId" value="#{purchaseOrderEdit.scopeSupplySplit.unit}"
                                      class="form-control"/>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-8">
                    <div class="form-group">
                        <h:outputLabel for="descriptionSplit"
                                       value="#{msgs['po.supply.scope.column.description']}"/>
                        <h:inputTextarea id="descriptionSplit" value="#{purchaseOrderEdit.scopeSupplySplit.description}"
                                         styleClass="form-control"/>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <h3 style="padding-left: 12px;">Source</h3>
                    <div class="col-sm-4">
                        <h:outputLabel value="#{msgs['supply.scope.lbl.delivery.date']}" style="margin-bottom: 10px;"/>
                        <p:calendar id="exWorkDateSplit"
                                    pattern="#{configuration.formatDate}"
                                    converterMessage="#{msgs['validator.date.invalid']}"
                                    mask="#{configuration.mask}"
                                    navigator="true"
                                    jsf:placeholder="#{configuration.formatDate}"
                                    value="#{purchaseOrderEdit.scopeSupplySplit.deliveryDate}"
                                    onselect="calendarChanges();" onchange="calendarChanges();">
                            <p:ajax event="dateSelect" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                            <p:ajax event="change" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                        </p:calendar>
                        <p:message id="msgSiteDate" for="exWorkDateSplit"/>
                        <p:inputTextarea maxlength="1000" type="text" style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.deliveryDateObs}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.work.date.observations']}"
                                         class="form-control"/>
                    </div>
                    <div class="col-sm-4">
                        <h:outputLabel value="#{msgs['supply.scope.lbl.work.date']}" style="margin-bottom: 10px;"/>
                        <p:calendar
                                pattern="#{configuration.formatDate}"
                                converterMessage="#{msgs['validator.date.invalid']}"
                                jsf:placeholder="#{configuration.formatDate}"
                                mask="#{configuration.mask}"
                                navigator="true"
                                value="#{purchaseOrderEdit.scopeSupplySplit.exWorkDate}"
                                onselect="calendarChanges();" onchange="calendarChanges();">
                            <p:ajax event="dateSelect" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                            <p:ajax event="change" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                        </p:calendar>
                        <p:inputTextarea maxlength="1000" type="text" style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.exWorkDateDescription}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.work.date.observations']}"
                                         class="form-control"/>
                    </div>
                    <div class="col-sm-4">
                        <h:outputLabel value="#{msgs['supply.scope.lbl.actual.ex.works.date']}" style="margin-bottom: 10px;"/>
                        <p:calendar
                                pattern="#{configuration.formatDate}"
                                converterMessage="#{msgs['validator.date.invalid']}"
                                jsf:placeholder="#{configuration.formatDate}"
                                mask="#{configuration.mask}"
                                navigator="true"
                                value="#{purchaseOrderEdit.scopeSupplySplit.actualExWorkDate}"
                                onselect="calendarChanges();" onchange="calendarChanges();">
                            <p:ajax event="dateSelect" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                            <p:ajax event="change" update=":scopeSupplySplitFormId:forescastSiteDateSplit"
                                    listener="#{purchaseOrderEdit.calculateDate}"/>
                        </p:calendar>
                        <p:inputTextarea maxlength="1000" type="text" style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.actualExWorkDateObs}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.work.date.observations']}"
                                         class="form-control"/>
                    </div>
            </div>

            <div class="col-md-12">
                <h3 style="padding-left: 12px;">#{msgs['supply.scope.split.lbl.destination']}</h3>
                    <div class="col-md-12">
                        <div class="col-sm-4" style="padding-left: 0px;">
                            <h:outputLabel for="deliveryTimeId"
                                           value="#{msgs['supply.scope.lbl.delivery.time']}"/>
                            <h:inputText id="deliveryTimeId" maxlength="255" type="text"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.deliveryLeadTimeQt}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.delivery.number']}"
                                         class="form-control">
                                <f:ajax execute="@this" render="siteDateCalculatedSplit"/>
                                <f:ajax event="change" render="forescastSiteDateSplit" listener="#{purchaseOrderEdit.calculateDate}"/>
                            </h:inputText>
                        </div>
                        <div class="col-sm-4" style="padding-left: 10px;">
                            <h:outputLabel for="measurementUnitSplit" class="control-label"
                                           value="Measure"/>
                            <h:selectOneMenu id="measurementUnitSplit"
                                             value="#{purchaseOrderEdit.scopeSupplySplit.deliveryLeadTimeMs}"
                                             styleClass="ui-selectonemenu-label ui-inputfield ui-corner-all">
                                <f:selectItems value="#{allTimeMeasurement}"/>
                                <f:ajax execute="@this" render="siteDateCalculatedSplit"/>
                                <f:ajax event="change" render="forescastSiteDateSplit" listener="#{purchaseOrderEdit.calculateDate}"/>
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="col-sm-4" style="margin-top: 10px;">
                        <h:outputLabel value="#{msgs['supply.scope.lbl.required.site.date']}" style="margin-bottom: 10px;"/>
                        <p:calendar id="siteId" pattern="#{configuration.formatDate}"
                                    converterMessage="#{msgs['validator.date.invalid']}"
                                    jsf:placeholder="#{configuration.formatDate}"
                                    mask="#{configuration.mask}"
                                    navigator="true"
                                    value="#{purchaseOrderEdit.scopeSupplySplit.requiredSiteDate}"
                                    onselect="calendarChanges();" onchange="calendarChanges();">
                        </p:calendar>
                        <p:message id="msgSisteDate" for="siteId"/>
                        <p:inputTextarea maxlength="1000" type="text"
                                         style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.requiredSiteDateObs}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.site.date.observations']}"
                                         class="form-control"/>
                    </div>
                    <div class="col-sm-4" style="margin-top: 10px;">
                        <div class="pull-left "><h:outputLabel style="margin-bottom: 10px; " value="#{msgs['supply.scope.lbl.site.date']}"/></div>
                        <div class="pull-right ">
                            <p:selectBooleanButton value="#{purchaseOrderEdit.scopeSupplySplit.isForecastSiteDateManual}"
                                                   onLabel="#{msgs['lbl.manual']}" offLabel="#{msgs['lbl.automatic']}" >
                                <p:ajax update=":scopeSupplySplitFormId:forescastSiteDateSplit" listener="#{purchaseOrderEdit.switchModeForecastSiteDate()}" />
                            </p:selectBooleanButton>
                        </div>
                        <p:calendar pattern="#{configuration.formatDate}"
                                    id="forescastSiteDateSplit"
                                    mask="#{configuration.mask}" navigator="true"
                                    converterMessage="#{msgs['validator.date.invalid']}"
                                    jsf:placeholder="#{configuration.formatDate}"
                                    disabled="#{purchaseOrderEdit.scopeSupplySplit.isForecastSiteDateManual}"
                                    value="#{purchaseOrderEdit.scopeSupplySplit.siteDate}"
                                    onselect="calendarChanges();" onchange="calendarChanges();">

                            <p:ajax event="dateSelect" />
                            <p:ajax event="change"/>
                        </p:calendar>
                        <p:inputTextarea maxlength="1000" type="text" style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.siteDateDescription}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.site.date.observations']}"
                                         class="form-control"/>
                    </div>
                    <div class="col-sm-4" style="margin-top: 10px;">
                        <h:outputLabel value="#{msgs['supply.scope.lbl.actual.site.date']}" style="margin-bottom: 10px;"/>
                        <p:calendar mask="#{configuration.mask}"
                                    navigator="true"
                                    pattern="#{configuration.formatDate}"
                                    converterMessage="#{msgs['validator.date.invalid']}"
                                    jsf:placeholder="#{configuration.formatDate}"
                                    value="#{purchaseOrderEdit.scopeSupplySplit.actualSiteDate}"
                                    onselect="calendarChanges();" onchange="calendarChanges();">
                        </p:calendar>
                        <p:inputTextarea maxlength="1000" type="text" style="margin-top: 10px; height: 34px;"
                                         value="#{purchaseOrderEdit.scopeSupplySplit.actualSiteDateObs}"
                                         jsf:placeholder="#{msgs['supply.scope.ph.site.date.observations']}"
                                         class="form-control"/>
                    </div>
            </div>
            <div class="clearfix"/>
            <br/>
            <div class="col-md-12">
                <div class="form-group">
                    <div class="pull-right">
                        <h:commandButton value="split" action="#{purchaseOrderEdit.split()}"
                                         class='btn btn-primary'>
                        </h:commandButton>
                        &#160;

                        <h:commandButton onclick="PF('confCancelDlg').show();"
                                         value="#{msgs['lbl.cancel']}"
                                         class='btn btn-primary'>
                            <p:ajax process="@this"/>
                        </h:commandButton>
                    </div>
                </div>
            </div>
        </div>

        <p:confirmDialog widgetVar="confCancelDlg" id="confirmDialogId" header="Cancel">
            <f:facet name="message">
                <div>
                    <div class="col-md-1">
                        <h:graphicImage name="img/icon-alert.jpg"/>
                    </div>
                    <div class="col-md-11">
                        Do you wish to leave this page and lose your unsaved data?
                        <br/>(including changes to Scopes of Supply).
                    </div>
                </div>
            </f:facet>

            <div class="pull-right">
                <h:commandButton value="#{msgs['lbl.yes']}" type="submit"
                                 role="button"
                                 class='btn btn-primary'
                                 action="#{purchaseOrderEdit.cancel}">
                </h:commandButton>
                &#160;
                <button class="btn btn-primary" type="button"
                        onclick="PF('confCancelDlg').hide();">
                    #{msgs['lbl.no']}
                </button>
            </div>
        </p:confirmDialog>
    </h:form>
    <h:outputScript name="js/calculateSplitQuantity.js"/>
</ui:define>
</ui:composition>
